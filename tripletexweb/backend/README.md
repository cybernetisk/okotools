# okoreports backend

This provides a backend api for the okoreports project. Its main
purpose is to fetch new data from external services that is used
in the reports that is generated by the frontend application.

## Development

Create the file `.env` and ensure it holds the correct configuration:

```text
TRIPLETEX_CONTEXT_ID=xxx
TRIPLETEX_CUSTOMER_TOKEN=xxx
TRIPLETEX_EMPLOYEE_TOKEN=xxx

# the following is optional

# where to persist data - should include trailing slash
# defaults to $PWD/reports/
REPORTS_DIR=/var/okoreports/reports/

# Path to Google Cloud Service Account credentials file.
# As of writing, we use credentials for okoreports@cyb-okotools.iam.gserviceaccount.com
OKOREPORTS_BUDGET_CREDENTIALS_FILE=xxx

# ID to a Google Spreadsheet
# e.g. 1pAEq8O5NMkmEWvW-c6x_47abg5IO7HqPO5bs5J-iPt4
# set to None to disable budget
OKOREPORTS_BUDGET_SPREADSHEET_ID=xxx
```

Make sure you have Python 3.10 or newer.

Set up environment and dependency:

```bash
cd okotools
python -m venv .venv
source .venv/bin/activate
cd tripletex
pip install -e ".[dev]"
cd ../tripletexweb/backend
pip install -r requirements.txt
```

Run the development server:

```bash
cd okotools/tripletexweb/backend
python app/app.py
```

## Docker image

See https://hub.docker.com/r/cybernetisk/okoreports-backend/

and https://cloud.docker.com/swarm/cybernetisk/repository/docker/cybernetisk/okoreports-backend/general

The image is rebuilt on each push to the Git repository.

## Using with reverse proxy

The following paths should reverse proxy to this service:

```bash
/reports/
/api/
```
